# 学生成绩管理系统 MVP 功能需求

## 1. 角色与权限（RBAC）

| 角色 | 查看成绩权限 | 录入/修改成绩 | 学生基础信息查看 | 导出 | 账号管理 |
| --- | --- | --- | --- | --- | --- |
| 学生 | 仅本人所有科目 | 否 | 仅本人 | 否 | 否 |
| 科目老师 | 仅所授科目下的所有学生 | 仅所授科目 | 所授科目范围内学生基本信息（姓名、学号、班级） | 仅所授科目范围内 | 否 |
| 校长 | 所有人、所有科目 | 否（MVP避免干扰学术权责） | 所有人 | 全量 | 可重置任意账号密码（MVP） |

**访问控制规则**

- 所有请求需登录身份，未登录拒绝。
- 角色不可越权；老师教授多科时，按科目合并授权视图。
- 导出功能仅提供 CSV。

## 2. 核心功能点

### 2.1 认证与登录

- 账号密码登录；登录后按角色跳转主页。
- 连续 5 次失败锁定账号 15 分钟，提示“账号或密码错误/账号锁定”。
- 支持退出登录。

### 2.2 账号与角色管理

- 预置模拟账号。
- 校长可检索账号并重置密码（生成随机密码且下次登录强制修改）。
- 老师、学生不可自助注册或修改角色。

### 2.3 学生信息维护

- 学生字段：学号、姓名、班级、状态（在读/休学）。
- 校长可读全量；老师仅可读所授科目范围学生；学生仅可读本人。
- 学生不可编辑个人基础信息。

### 2.4 科目与授课关系

- 预置科目清单及老师-科目绑定。
- 每位老师至少绑定一个科目，可关联多个班级。

### 2.5 考试与成绩管理

- 考试字段：考试ID、名称、学期、考试日期、适用班级、状态（发布/未发布）。
- 成绩字段：学号、科目、考试ID、分数（0–100，1 位小数）、录入老师、录入时间、修订历史（至少 1 条）。
- 成绩仅对应科目老师可录入/修改，支持 CSV 批量导入与单条编辑。
- 成绩默认未发布，发布后学生可见；未发布仅老师与校长可见。
- 校验重复录入：同学号+科目+考试ID 至多一条（修改覆盖）。

### 2.6 成绩查看

**学生视图**

- 我的成绩表按考试分组，展示考试名称/日期、科目、分数、班级均分，可选班级排名。
- 支持按学期、考试筛选。

**老师视图**

- 展示学生（姓名、学号、班级）、科目、分数、是否发布。
- 支持班级、考试筛选，按分数或学号排序。
- 支持当前科目成绩导入/导出 CSV。

**校长视图**

- 总览：按考试与科目统计最高/最低/平均/及格率。
- 明细：全量成绩表，支持班级、科目、考试筛选。
- 支持全校成绩导出 CSV。

### 2.7 审计与变更记录

- 记录成绩新增/修改日志：时间、操作者（老师ID）、目标记录键（学号+科目+考试ID）、前后分数。
- 校长可检索所有日志；老师仅可见所授科目日志；学生不可见。

### 2.8 通知

- 成绩发布后，学生主页显示“新成绩已发布”标记，查看后清除。
- 不提供站外通知。

### 2.9 导入/导出

- CSV 模板：
  - 导入：`exam_id,subject_code,student_no,score`
  - 导出字段：考试、科目、学号、姓名、班级、分数。
- 导入校验：学号存在、科目匹配、分数合法、重复键覆盖。

### 2.10 搜索与筛选

- 统一筛选条件：学期、考试、班级、科目（按角色限制）。
- 关键字搜索：学号或姓名，仅针对有权限的数据。

### 2.11 隐私与合规

- 学生不能查看他人成绩。
- 导出限于权限范围，导出操作写入审计日志。
- 页面仅展示必要字段，不含敏感信息。

### 2.12 错误与提示

- 通用错误：权限不足、未登录、参数不合法、数据不存在、账号锁定。
- 导入错误清单：逐行包含行号和原因。

## 3. 数据模型

- 学生：`student_no*`，`name`，`class_name`，`status`
- 科目：`subject_code*`，`subject_name`
- 老师：`teacher_id*`，`name`，`subjects[]`，`classes[]`
- 考试：`exam_id*`，`exam_name`，`term`，`exam_date`，`classes[]`，`status`
- 成绩：`exam_id*`，`subject_code*`，`student_no*`，`score`，`created_by`，`created_at`，`updated_at`
- 账号：`username*`，`role`，`bind_id`，`password_hash`，`status`

## 4. 报表与统计

- 学生个人页：每次考试成绩和班级均分。
- 老师学科页：所授科目在某次考试下的最高/最低/平均/及格率。
- 校长总览页：考试×科目矩阵的最高/最低/平均/及格率。

## 5. 用户关键流程

1. 老师登录 → 选择考试 → 批量导入或逐条录入成绩 → 校验通过后保存（未发布）。
2. 老师确认无误 → 将本科目成绩设为“发布”。
3. 学生登录 → 查看发布后的个人成绩。
4. 校长登录 → 查看总览/明细 → 可导出全校成绩 → 可重置账号密码。
5. 如需更正 → 老师修改已发布成绩，保留审计记录，学生端同步更新。

## 6. 模拟数据与账号

### 6.1 班级与科目

- 班级：Class 1、Class 2
- 科目：语文（CHN）、数学（MTH）、英语（ENG）

### 6.2 学生

| student_no | name | class_name | status |
| --- | --- | --- | --- |
| S001 | 张三 | Class 1 | 在读 |
| S002 | 李四 | Class 1 | 在读 |
| S003 | 王五 | Class 1 | 在读 |
| S004 | 赵六 | Class 2 | 在读 |
| S005 | 孙七 | Class 2 | 在读 |
| S006 | 周八 | Class 2 | 在读 |

### 6.3 老师

| teacher_id | name | subjects | classes |
| --- | --- | --- | --- |
| T100 | 陈老师 | CHN | Class 1, Class 2 |
| T200 | 刘老师 | MTH | Class 1, Class 2 |
| T300 | 吴老师 | ENG | Class 1, Class 2 |

### 6.4 考试

| exam_id | exam_name | term | exam_date | classes | status |
| --- | --- | --- | --- | --- | --- |
| EX2025M | 2025-上学期-期中考试 | 2025-上 | 2025-05-20 | Class 1, Class 2 | 发布 |

### 6.5 成绩样例

- 语文（CHN）：S001 88，S002 76，S003 92，S004 81，S005 67，S006 85。
- 数学（MTH）：S001 95，S002 82，S003 78，S004 88，S005 73，S006 90。
- 英语（ENG）：S001 84，S002 79，S003 91，S004 86，S005 72，S006 88。

以上成绩绑定 `exam_id=EX2025M` 且状态为发布，`created_by` 为对应科目老师。

### 6.6 登录账号

初始密码：`Pass@123`（首次登录需修改）。

- 校长：`principal`
- 老师：`t_chn`（T100/CHN）、`t_mth`（T200/MTH）、`t_eng`（T300/ENG）
- 学生：`s_s001`、`s_s002`、`s_s003`、`s_s004`、`s_s005`、`s_s006`

## 7. 约束与校验

- 分数范围 0–100，保留 1 位小数。
- 学号、科目、考试需存在且有效；重复键导入覆盖旧记录。
- 所有操作先校验权限。
- 导入单次不超过 5,000 行，超限需分批。

## 8. 验收标准

1. 学生无法查看他人成绩。
2. 老师仅能访问和导出所授科目成绩。
3. 校长可查看并导出全量数据。
4. 未发布成绩学生不可见；发布后与老师端一致。
5. 导入校验与覆盖策略生效，错误行返回原因。
6. 审计日志可追踪成绩新增/修改。
7. 连续 5 次登录失败锁定账号 15 分钟，可通过校长重置或解锁。
